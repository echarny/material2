{"version":3,"file":"bottom-sheet-container.js","sourceRoot":"","sources":["../../../../src/lib/bottom-sheet/bottom-sheet-container.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright Google LLC All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an MIT-style license that can be\r\n * found in the LICENSE file at https://angular.io/license\r\n */\r\n\r\nimport {\r\n  Component,\r\n  ComponentRef,\r\n  EmbeddedViewRef,\r\n  ViewChild,\r\n  OnDestroy,\r\n  ElementRef,\r\n  ChangeDetectionStrategy,\r\n  ViewEncapsulation,\r\n  ChangeDetectorRef,\r\n  EventEmitter,\r\n  Inject,\r\n  Optional,\r\n} from '@angular/core';\r\nimport {AnimationEvent} from '@angular/animations';\r\nimport {\r\n  BasePortalOutlet,\r\n  ComponentPortal,\r\n  TemplatePortal,\r\n  CdkPortalOutlet,\r\n} from '@angular/cdk/portal';\r\nimport {BreakpointObserver, Breakpoints} from '@angular/cdk/layout';\r\nimport {MatBottomSheetConfig} from './bottom-sheet-config';\r\nimport {matBottomSheetAnimations} from './bottom-sheet-animations';\r\nimport {Subscription} from 'rxjs';\r\nimport {DOCUMENT} from '@angular/common';\r\nimport {FocusTrap, FocusTrapFactory} from '@angular/cdk/a11y';\r\n\r\n// TODO(crisbeto): consolidate some logic between this, MatDialog and MatSnackBar\r\n\r\n/**\r\n * Internal component that wraps user-provided bottom sheet content.\r\n * @docs-private\r\n */\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'mat-bottom-sheet-container',\r\n  templateUrl: 'bottom-sheet-container.html',\r\n  styleUrls: ['bottom-sheet-container.css'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  encapsulation: ViewEncapsulation.None,\r\n  animations: [matBottomSheetAnimations.bottomSheetState],\r\n  host: {\r\n    'class': 'mat-bottom-sheet-container',\r\n    'tabindex': '-1',\r\n    'role': 'dialog',\r\n    'aria-modal': 'true',\r\n    '[attr.aria-label]': 'bottomSheetConfig?.ariaLabel',\r\n    '[@state]': '_animationState',\r\n    '(@state.start)': '_onAnimationStart($event)',\r\n    '(@state.done)': '_onAnimationDone($event)'\r\n  },\r\n})\r\nexport class MatBottomSheetContainer extends BasePortalOutlet implements OnDestroy {\r\n  private _breakpointSubscription: Subscription;\r\n\r\n  /** The portal outlet inside of this container into which the content will be loaded. */\r\n  @ViewChild(CdkPortalOutlet) _portalOutlet: CdkPortalOutlet;\r\n\r\n  /** The state of the bottom sheet animations. */\r\n  _animationState: 'void' | 'visible' | 'hidden' = 'void';\r\n\r\n  /** Emits whenever the state of the animation changes. */\r\n  _animationStateChanged = new EventEmitter<AnimationEvent>();\r\n\r\n  /** The class that traps and manages focus within the bottom sheet. */\r\n  private _focusTrap: FocusTrap;\r\n\r\n  /** Element that was focused before the bottom sheet was opened. */\r\n  private _elementFocusedBeforeOpened: HTMLElement | null = null;\r\n\r\n  /** Server-side rendering-compatible reference to the global document object. */\r\n  private _document: Document;\r\n\r\n  /** Whether the component has been destroyed. */\r\n  private _destroyed: boolean;\r\n\r\n  constructor(\r\n    private _elementRef: ElementRef,\r\n    private _changeDetectorRef: ChangeDetectorRef,\r\n    private _focusTrapFactory: FocusTrapFactory,\r\n    breakpointObserver: BreakpointObserver,\r\n    @Optional() @Inject(DOCUMENT) document: any,\r\n    /** The bottom sheet configuration. */\r\n    public bottomSheetConfig: MatBottomSheetConfig) {\r\n    super();\r\n\r\n    this._document = document;\r\n    this._breakpointSubscription = breakpointObserver\r\n      .observe([Breakpoints.Medium, Breakpoints.Large, Breakpoints.XLarge])\r\n      .subscribe(() => {\r\n        this._toggleClass('mat-bottom-sheet-container-medium',\r\n            breakpointObserver.isMatched(Breakpoints.Medium));\r\n        this._toggleClass('mat-bottom-sheet-container-large',\r\n            breakpointObserver.isMatched(Breakpoints.Large));\r\n        this._toggleClass('mat-bottom-sheet-container-xlarge',\r\n            breakpointObserver.isMatched(Breakpoints.XLarge));\r\n      });\r\n  }\r\n\r\n  /** Attach a component portal as content to this bottom sheet container. */\r\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\r\n    this._validatePortalAttached();\r\n    this._setPanelClass();\r\n    this._savePreviouslyFocusedElement();\r\n    return this._portalOutlet.attachComponentPortal(portal);\r\n  }\r\n\r\n  /** Attach a template portal as content to this bottom sheet container. */\r\n  attachTemplatePortal<C>(portal: TemplatePortal<C>): EmbeddedViewRef<C> {\r\n    this._validatePortalAttached();\r\n    this._setPanelClass();\r\n    this._savePreviouslyFocusedElement();\r\n    return this._portalOutlet.attachTemplatePortal(portal);\r\n  }\r\n\r\n  /** Begin animation of bottom sheet entrance into view. */\r\n  enter(): void {\r\n    if (!this._destroyed) {\r\n      this._animationState = 'visible';\r\n      this._changeDetectorRef.detectChanges();\r\n    }\r\n  }\r\n\r\n  /** Begin animation of the bottom sheet exiting from view. */\r\n  exit(): void {\r\n    if (!this._destroyed) {\r\n      this._animationState = 'hidden';\r\n      this._changeDetectorRef.markForCheck();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this._breakpointSubscription.unsubscribe();\r\n    this._destroyed = true;\r\n  }\r\n\r\n  _onAnimationDone(event: AnimationEvent) {\r\n    if (event.toState === 'hidden') {\r\n      this._restoreFocus();\r\n    } else if (event.toState === 'visible' && this.bottomSheetConfig.autoFocus) {\r\n      this._trapFocus();\r\n    }\r\n\r\n    this._animationStateChanged.emit(event);\r\n  }\r\n\r\n  _onAnimationStart(event: AnimationEvent) {\r\n    this._animationStateChanged.emit(event);\r\n  }\r\n\r\n  private _toggleClass(cssClass: string, add: boolean) {\r\n    const classList = this._elementRef.nativeElement.classList;\r\n    add ? classList.add(cssClass) : classList.remove(cssClass);\r\n  }\r\n\r\n  private _validatePortalAttached() {\r\n    if (this._portalOutlet.hasAttached()) {\r\n      throw Error('Attempting to attach bottom sheet content after content is already attached');\r\n    }\r\n  }\r\n\r\n  private _setPanelClass() {\r\n    const element: HTMLElement = this._elementRef.nativeElement;\r\n    const panelClass = this.bottomSheetConfig.panelClass;\r\n\r\n    if (Array.isArray(panelClass)) {\r\n      // Note that we can't use a spread here, because IE doesn't support multiple arguments.\r\n      panelClass.forEach(cssClass => element.classList.add(cssClass));\r\n    } else if (panelClass) {\r\n      element.classList.add(panelClass);\r\n    }\r\n  }\r\n\r\n\r\n  /** Moves the focus inside the focus trap. */\r\n  private _trapFocus() {\r\n    if (!this._focusTrap) {\r\n      this._focusTrap = this._focusTrapFactory.create(this._elementRef.nativeElement);\r\n    }\r\n\r\n    this._focusTrap.focusInitialElementWhenReady();\r\n  }\r\n\r\n  /** Restores focus to the element that was focused before the bottom sheet opened. */\r\n  private _restoreFocus() {\r\n    const toFocus = this._elementFocusedBeforeOpened;\r\n\r\n    // We need the extra check, because IE can set the `activeElement` to null in some cases.\r\n    if (toFocus && typeof toFocus.focus === 'function') {\r\n      toFocus.focus();\r\n    }\r\n\r\n    if (this._focusTrap) {\r\n      this._focusTrap.destroy();\r\n    }\r\n  }\r\n\r\n  /** Saves a reference to the element that was focused before the bottom sheet was opened. */\r\n  private _savePreviouslyFocusedElement() {\r\n    this._elementFocusedBeforeOpened = this._document.activeElement as HTMLElement;\r\n\r\n    // The `focus` method isn't available during server-side rendering.\r\n    if (this._elementRef.nativeElement.focus) {\r\n      Promise.resolve().then(() => this._elementRef.nativeElement.focus());\r\n    }\r\n  }\r\n}\r\n"]}