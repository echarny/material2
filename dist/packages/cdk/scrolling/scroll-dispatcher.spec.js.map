{"version":3,"file":"scroll-dispatcher.spec.js","sourceRoot":"","sources":["../../../../src/cdk/scrolling/scroll-dispatcher.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import {inject, TestBed, async, fakeAsync, ComponentFixture, tick} from '@angular/core/testing';\r\nimport {NgModule, Component, ViewChild, ElementRef} from '@angular/core';\r\nimport {CdkScrollable, ScrollDispatcher, ScrollingModule} from './public-api';\r\nimport {dispatchFakeEvent} from '@angular/cdk/testing';\r\n\r\ndescribe('ScrollDispatcher', () => {\r\n\r\n  beforeEach(async(() => {\r\n    TestBed.configureTestingModule({\r\n      imports: [ScrollTestModule],\r\n    });\r\n\r\n    TestBed.compileComponents();\r\n  }));\r\n\r\n  describe('Basic usage', () => {\r\n    let scroll: ScrollDispatcher;\r\n    let fixture: ComponentFixture<ScrollingComponent>;\r\n\r\n    beforeEach(inject([ScrollDispatcher], (s: ScrollDispatcher) => {\r\n      scroll = s;\r\n\r\n      fixture = TestBed.createComponent(ScrollingComponent);\r\n      fixture.detectChanges();\r\n    }));\r\n\r\n    it('should be registered with the scrollable directive with the scroll service', () => {\r\n      const componentScrollable = fixture.componentInstance.scrollable;\r\n      expect(scroll.scrollContainers.has(componentScrollable)).toBe(true);\r\n    });\r\n\r\n    it('should have the scrollable directive deregistered when the component is destroyed', () => {\r\n      const componentScrollable = fixture.componentInstance.scrollable;\r\n      expect(scroll.scrollContainers.has(componentScrollable)).toBe(true);\r\n\r\n      fixture.destroy();\r\n      expect(scroll.scrollContainers.has(componentScrollable)).toBe(false);\r\n    });\r\n\r\n    it('should notify through the directive and service that a scroll event occurred',\r\n        fakeAsync(() => {\r\n      // Listen for notifications from scroll directive\r\n      const scrollable = fixture.componentInstance.scrollable;\r\n      const directiveSpy = jasmine.createSpy('directive scroll callback');\r\n      scrollable.elementScrolled().subscribe(directiveSpy);\r\n\r\n      // Listen for notifications from scroll service with a throttle of 100ms\r\n      const throttleTime = 100;\r\n      const serviceSpy = jasmine.createSpy('service scroll callback');\r\n      scroll.scrolled(throttleTime).subscribe(serviceSpy);\r\n\r\n      // Emit a scroll event from the scrolling element in our component.\r\n      // This event should be picked up by the scrollable directive and notify.\r\n      // The notification should be picked up by the service.\r\n      dispatchFakeEvent(fixture.componentInstance.scrollingElement.nativeElement, 'scroll', false);\r\n\r\n      // The scrollable directive should have notified the service immediately.\r\n      expect(directiveSpy).toHaveBeenCalled();\r\n\r\n      // Verify that the throttle is used, the service should wait for the throttle time until\r\n      // sending the notification.\r\n      expect(serviceSpy).not.toHaveBeenCalled();\r\n\r\n      // After the throttle time, the notification should be sent.\r\n      tick(throttleTime);\r\n      expect(serviceSpy).toHaveBeenCalled();\r\n    }));\r\n\r\n    it('should not execute the global events in the Angular zone', () => {\r\n      scroll.scrolled(0).subscribe(() => {});\r\n      dispatchFakeEvent(document, 'scroll', false);\r\n\r\n      expect(fixture.ngZone!.isStable).toBe(true);\r\n    });\r\n\r\n    it('should not execute the scrollable events in the Angular zone', () => {\r\n      dispatchFakeEvent(fixture.componentInstance.scrollingElement.nativeElement, 'scroll');\r\n      expect(fixture.ngZone!.isStable).toBe(true);\r\n    });\r\n\r\n    it('should be able to unsubscribe from the global scrollable', () => {\r\n      const spy = jasmine.createSpy('global scroll callback');\r\n      const subscription = scroll.scrolled(0).subscribe(spy);\r\n\r\n      dispatchFakeEvent(document, 'scroll', false);\r\n      expect(spy).toHaveBeenCalledTimes(1);\r\n\r\n      subscription.unsubscribe();\r\n      dispatchFakeEvent(document, 'scroll', false);\r\n\r\n      expect(spy).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should complete the `scrolled` stream on destroy', () => {\r\n      const completeSpy = jasmine.createSpy('complete spy');\r\n      const subscription = scroll.scrolled(0).subscribe(undefined, undefined, completeSpy);\r\n\r\n      scroll.ngOnDestroy();\r\n\r\n      expect(completeSpy).toHaveBeenCalled();\r\n\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n    it('should complete the scrollable stream when it is destroyed', () => {\r\n      const scrollable = fixture.componentInstance.scrollable;\r\n      const spy = jasmine.createSpy('complete spy');\r\n      const subscription = scrollable.elementScrolled().subscribe(undefined, undefined, spy);\r\n\r\n      fixture.destroy();\r\n      expect(spy).toHaveBeenCalled();\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n  });\r\n\r\n  describe('Nested scrollables', () => {\r\n    let scroll: ScrollDispatcher;\r\n    let fixture: ComponentFixture<NestedScrollingComponent>;\r\n    let element: ElementRef;\r\n\r\n    beforeEach(inject([ScrollDispatcher], (s: ScrollDispatcher) => {\r\n      scroll = s;\r\n\r\n      fixture = TestBed.createComponent(NestedScrollingComponent);\r\n      fixture.detectChanges();\r\n      element = fixture.componentInstance.interestingElement;\r\n    }));\r\n\r\n    it('should be able to identify the containing scrollables of an element', () => {\r\n      const scrollContainers = scroll.getAncestorScrollContainers(element);\r\n      const scrollableElementIds =\r\n          scrollContainers.map(scrollable => scrollable.getElementRef().nativeElement.id);\r\n\r\n      expect(scrollableElementIds).toEqual(['scrollable-1', 'scrollable-1a']);\r\n    });\r\n\r\n    it('should emit when one of the ancestor scrollable containers is scrolled', () => {\r\n      const spy = jasmine.createSpy('scroll spy');\r\n      const subscription = scroll.ancestorScrolled(element, 0).subscribe(spy);\r\n      const grandparent = fixture.debugElement.nativeElement.querySelector('#scrollable-1');\r\n\r\n      dispatchFakeEvent(grandparent, 'scroll', false);\r\n      expect(spy).toHaveBeenCalledTimes(1);\r\n\r\n      dispatchFakeEvent(window.document, 'scroll', false);\r\n      expect(spy).toHaveBeenCalledTimes(2);\r\n\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n    it('should not emit when a non-ancestor is scrolled', () => {\r\n      const spy = jasmine.createSpy('scroll spy');\r\n      const subscription = scroll.ancestorScrolled(element, 0).subscribe(spy);\r\n      const stranger = fixture.debugElement.nativeElement.querySelector('#scrollable-2');\r\n\r\n      dispatchFakeEvent(stranger, 'scroll', false);\r\n      expect(spy).not.toHaveBeenCalled();\r\n\r\n      subscription.unsubscribe();\r\n    });\r\n  });\r\n\r\n  describe('lazy subscription', () => {\r\n    let scroll: ScrollDispatcher;\r\n\r\n    beforeEach(inject([ScrollDispatcher], (s: ScrollDispatcher) => {\r\n      scroll = s;\r\n    }));\r\n\r\n    it('should lazily add global listeners as service subscriptions are added and removed', () => {\r\n      expect(scroll._globalSubscription).toBeNull('Expected no global listeners on init.');\r\n\r\n      const subscription = scroll.scrolled(0).subscribe(() => {});\r\n\r\n      expect(scroll._globalSubscription).toBeTruthy(\r\n          'Expected global listeners after a subscription has been added.');\r\n\r\n      subscription.unsubscribe();\r\n\r\n      expect(scroll._globalSubscription).toBeNull(\r\n          'Expected global listeners to have been removed after the subscription has stopped.');\r\n    });\r\n\r\n    it('should remove global listeners on unsubscribe, despite any other live scrollables', () => {\r\n      const fixture = TestBed.createComponent(NestedScrollingComponent);\r\n      fixture.detectChanges();\r\n\r\n      expect(scroll._globalSubscription).toBeNull('Expected no global listeners on init.');\r\n      expect(scroll.scrollContainers.size).toBe(4, 'Expected multiple scrollables');\r\n\r\n      const subscription = scroll.scrolled(0).subscribe(() => {});\r\n\r\n      expect(scroll._globalSubscription).toBeTruthy(\r\n          'Expected global listeners after a subscription has been added.');\r\n\r\n      subscription.unsubscribe();\r\n\r\n      expect(scroll._globalSubscription).toBeNull(\r\n          'Expected global listeners to have been removed after the subscription has stopped.');\r\n      expect(scroll.scrollContainers.size)\r\n          .toBe(4, 'Expected scrollable count to stay the same');\r\n    });\r\n\r\n    it('should remove the global subscription on destroy', () => {\r\n      expect(scroll._globalSubscription).toBeNull('Expected no global listeners on init.');\r\n\r\n      const subscription = scroll.scrolled(0).subscribe(() => {});\r\n\r\n      expect(scroll._globalSubscription).toBeTruthy(\r\n          'Expected global listeners after a subscription has been added.');\r\n\r\n      scroll.ngOnDestroy();\r\n\r\n      expect(scroll._globalSubscription).toBeNull(\r\n          'Expected global listeners to have been removed after the subscription has stopped.');\r\n\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n  });\r\n});\r\n\r\n\r\n/** Simple component that contains a large div and can be scrolled. */\r\n@Component({\r\n  template: `<div #scrollingElement cdk-scrollable style=\"height: 9999px\"></div>`\r\n})\r\nclass ScrollingComponent {\r\n  @ViewChild(CdkScrollable) scrollable: CdkScrollable;\r\n  @ViewChild('scrollingElement') scrollingElement: ElementRef;\r\n}\r\n\r\n\r\n/** Component containing nested scrollables. */\r\n@Component({\r\n  template: `\r\n    <div id=\"scrollable-1\" cdk-scrollable>\r\n      <div id=\"scrollable-1a\" cdk-scrollable>\r\n        <div #interestingElement></div>\r\n      </div>\r\n      <div id=\"scrollable-1b\" cdk-scrollable></div>\r\n    </div>\r\n    <div id=\"scrollable-2\" cdk-scrollable></div>\r\n  `\r\n})\r\nclass NestedScrollingComponent {\r\n  @ViewChild('interestingElement') interestingElement: ElementRef;\r\n}\r\n\r\nconst TEST_COMPONENTS = [ScrollingComponent, NestedScrollingComponent];\r\n@NgModule({\r\n  imports: [ScrollingModule],\r\n  providers: [ScrollDispatcher],\r\n  exports: TEST_COMPONENTS,\r\n  declarations: TEST_COMPONENTS,\r\n  entryComponents: TEST_COMPONENTS,\r\n})\r\nclass ScrollTestModule { }\r\n"]}