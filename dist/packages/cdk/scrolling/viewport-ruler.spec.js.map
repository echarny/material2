{"version":3,"file":"viewport-ruler.spec.js","sourceRoot":"","sources":["../../../../src/cdk/scrolling/viewport-ruler.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import {TestBed, inject, fakeAsync, tick} from '@angular/core/testing';\r\nimport {ScrollingModule} from './public-api';\r\nimport {ViewportRuler} from './viewport-ruler';\r\nimport {dispatchFakeEvent} from '@angular/cdk/testing';\r\n\r\n\r\n// For all tests, we assume the browser window is 1024x786 (outerWidth x outerHeight).\r\n// The karma config has been set to this for local tests, and it is the default size\r\n// for tests on CI (both SauceLabs and Browserstack).\r\n\r\n// While we know the *outer* window width/height, the innerWidth and innerHeight depend on the\r\n// the size of the individual browser's chrome, so we have to use window.innerWidth and\r\n// window.innerHeight in the unit test instead of hard-coded values.\r\n\r\ndescribe('ViewportRuler', () => {\r\n  let ruler: ViewportRuler;\r\n\r\n  let startingWindowWidth = window.innerWidth;\r\n  let startingWindowHeight = window.innerHeight;\r\n\r\n  // Create a very large element that will make the page scrollable.\r\n  let veryLargeElement: HTMLElement = document.createElement('div');\r\n  veryLargeElement.style.width = '6000px';\r\n  veryLargeElement.style.height = '6000px';\r\n\r\n  beforeEach(() => TestBed.configureTestingModule({\r\n    imports: [ScrollingModule],\r\n    providers: [ViewportRuler]\r\n  }));\r\n\r\n  beforeEach(inject([ViewportRuler], (viewportRuler: ViewportRuler) => {\r\n    ruler = viewportRuler;\r\n    scrollTo(0, 0);\r\n  }));\r\n\r\n  afterEach(() => {\r\n    ruler.ngOnDestroy();\r\n  });\r\n\r\n  it('should get the viewport size', () => {\r\n    let size = ruler.getViewportSize();\r\n    expect(size.width).toBe(window.innerWidth);\r\n    expect(size.height).toBe(window.innerHeight);\r\n  });\r\n\r\n  it('should get the viewport bounds when the page is not scrolled', () => {\r\n    let bounds = ruler.getViewportRect();\r\n    expect(bounds.top).toBe(0);\r\n    expect(bounds.left).toBe(0);\r\n    expect(bounds.bottom).toBe(window.innerHeight);\r\n    expect(bounds.right).toBe(window.innerWidth);\r\n  });\r\n\r\n  it('should get the viewport bounds when the page is scrolled', () => {\r\n    document.body.appendChild(veryLargeElement);\r\n\r\n    scrollTo(1500, 2000);\r\n\r\n    let bounds = ruler.getViewportRect();\r\n\r\n    // In the iOS simulator (BrowserStack & SauceLabs), adding the content to the\r\n    // body causes karma's iframe for the test to stretch to fit that content once we attempt to\r\n    // scroll the page. Setting width / height / maxWidth / maxHeight on the iframe does not\r\n    // successfully constrain its size. As such, skip assertions in environments where the\r\n    // window size has changed since the start of the test.\r\n    if (window.innerWidth > startingWindowWidth || window.innerHeight > startingWindowHeight) {\r\n      document.body.removeChild(veryLargeElement);\r\n      return;\r\n    }\r\n\r\n    expect(bounds.top).toBe(2000);\r\n    expect(bounds.left).toBe(1500);\r\n    expect(bounds.bottom).toBe(2000 + window.innerHeight);\r\n    expect(bounds.right).toBe(1500 + window.innerWidth);\r\n\r\n    document.body.removeChild(veryLargeElement);\r\n  });\r\n\r\n  it('should get the bounds based on client coordinates when the page is pinch-zoomed', () => {\r\n    // There is no API to make the browser pinch-zoom, so there's no real way to automate\r\n    // tests for this behavior. Leaving this test here as documentation for the behavior.\r\n  });\r\n\r\n  it('should get the scroll position when the page is not scrolled', () => {\r\n    let scrollPos = ruler.getViewportScrollPosition();\r\n    expect(scrollPos.top).toBe(0);\r\n    expect(scrollPos.left).toBe(0);\r\n  });\r\n\r\n  it('should get the scroll position when the page is scrolled', () => {\r\n    document.body.appendChild(veryLargeElement);\r\n\r\n    scrollTo(1500, 2000);\r\n\r\n    // In the iOS simulator (BrowserStack & SauceLabs), adding the content to the\r\n    // body causes karma's iframe for the test to stretch to fit that content once we attempt to\r\n    // scroll the page. Setting width / height / maxWidth / maxHeight on the iframe does not\r\n    // successfully constrain its size. As such, skip assertions in environments where the\r\n    // window size has changed since the start of the test.\r\n    if (window.innerWidth > startingWindowWidth || window.innerHeight > startingWindowHeight) {\r\n      document.body.removeChild(veryLargeElement);\r\n      return;\r\n    }\r\n\r\n    let scrollPos = ruler.getViewportScrollPosition();\r\n    expect(scrollPos.top).toBe(2000);\r\n    expect(scrollPos.left).toBe(1500);\r\n\r\n    document.body.removeChild(veryLargeElement);\r\n  });\r\n\r\n  describe('changed event', () => {\r\n    it('should dispatch an event when the window is resized', () => {\r\n      const spy = jasmine.createSpy('viewport changed spy');\r\n      const subscription = ruler.change(0).subscribe(spy);\r\n\r\n      dispatchFakeEvent(window, 'resize');\r\n      expect(spy).toHaveBeenCalled();\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n    it('should dispatch an event when the orientation is changed', () => {\r\n      const spy = jasmine.createSpy('viewport changed spy');\r\n      const subscription = ruler.change(0).subscribe(spy);\r\n\r\n      dispatchFakeEvent(window, 'orientationchange');\r\n      expect(spy).toHaveBeenCalled();\r\n      subscription.unsubscribe();\r\n    });\r\n\r\n    it('should be able to throttle the callback', fakeAsync(() => {\r\n      const spy = jasmine.createSpy('viewport changed spy');\r\n      const subscription = ruler.change(1337).subscribe(spy);\r\n\r\n      dispatchFakeEvent(window, 'resize');\r\n      expect(spy).not.toHaveBeenCalled();\r\n\r\n      tick(1337);\r\n\r\n      expect(spy).toHaveBeenCalledTimes(1);\r\n      subscription.unsubscribe();\r\n    }));\r\n  });\r\n});\r\n"]}