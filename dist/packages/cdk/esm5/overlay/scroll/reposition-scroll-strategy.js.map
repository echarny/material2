{"version":3,"file":"reposition-scroll-strategy.js","sourceRoot":"","sources":["../../../../../../src/cdk/overlay/scroll/reposition-scroll-strategy.ts"],"names":[],"mappings":";;;;;;;;;;;AAUA,OAAO,EAAiB,wCAAwC,EAAC,MAAM,mBAAmB,CAAC;AAG3F,OAAO,EAAC,4BAA4B,EAAC,MAAM,yBAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;AAgBrE;;;AAAA;IAIE,kCACU,mBACA,gBACA,SACA;QAHA,sBAAiB,GAAjB,iBAAiB;QACjB,mBAAc,GAAd,cAAc;QACd,YAAO,GAAP,OAAO;QACP,YAAO,GAAP,OAAO;mCAPgC,IAAI;KAOE;IAEvD,mDAAmD;;;;;;IACnD,yCAAM;;;;;IAAN,UAAO,UAA4B;QACjC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,MAAM,wCAAwC,EAAE,CAAC;SAClD;QAED,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;KAC/B;IAED,+DAA+D;;;;;IAC/D,yCAAM;;;;IAAN;QAAA,iBAuBC;QAtBC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;YAC9B,qBAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;YAEhE,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC;gBAC7E,KAAI,CAAC,WAAW,CAAC,cAAc,EAAE,CAAC;;gBAGlC,EAAE,CAAC,CAAC,KAAI,CAAC,OAAO,IAAI,KAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;oBAC3C,qBAAM,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,cAAc,CAAC,qBAAqB,EAAE,CAAC;oBAC5E,iDAAO,gBAAK,EAAE,kBAAM,CAA0C;;;oBAI9D,qBAAM,WAAW,GAAG,CAAC,EAAC,KAAK,OAAA,EAAE,MAAM,QAAA,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAC,CAAC,CAAC;oBAErF,EAAE,CAAC,CAAC,4BAA4B,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC;wBAC3D,KAAI,CAAC,OAAO,EAAE,CAAC;wBACf,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC,cAAM,OAAA,KAAI,CAAC,WAAW,CAAC,MAAM,EAAE,EAAzB,CAAyB,CAAC,CAAC;qBACnD;iBACF;aACF,CAAC,CAAC;SACJ;KACF;IAED,gEAAgE;;;;;IAChE,0CAAO;;;;IAAP;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;YAC7B,IAAI,CAAC,mBAAmB,CAAC,WAAW,EAAE,CAAC;YACvC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;SACjC;KACF;mCAhFH;IAiFC,CAAA;;;;AApDD,oCAoDC","sourcesContent":["/**\r\n * @license\r\n * Copyright Google LLC All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an MIT-style license that can be\r\n * found in the LICENSE file at https://angular.io/license\r\n */\r\n\r\nimport {NgZone} from '@angular/core';\r\nimport {Subscription} from 'rxjs';\r\nimport {ScrollStrategy, getMatScrollStrategyAlreadyAttachedError} from './scroll-strategy';\r\nimport {OverlayReference} from '../overlay-reference';\r\nimport {ScrollDispatcher, ViewportRuler} from '@angular/cdk/scrolling';\r\nimport {isElementScrolledOutsideView} from '../position/scroll-clip';\r\n\r\n/**\r\n * Config options for the RepositionScrollStrategy.\r\n */\r\nexport interface RepositionScrollStrategyConfig {\r\n  /** Time in milliseconds to throttle the scroll events. */\r\n  scrollThrottle?: number;\r\n\r\n  /** Whether to close the overlay once the user has scrolled away completely. */\r\n  autoClose?: boolean;\r\n}\r\n\r\n/**\r\n * Strategy that will update the element position as the user is scrolling.\r\n */\r\nexport class RepositionScrollStrategy implements ScrollStrategy {\r\n  private _scrollSubscription: Subscription|null = null;\r\n  private _overlayRef: OverlayReference;\r\n\r\n  constructor(\r\n    private _scrollDispatcher: ScrollDispatcher,\r\n    private _viewportRuler: ViewportRuler,\r\n    private _ngZone: NgZone,\r\n    private _config?: RepositionScrollStrategyConfig) { }\r\n\r\n  /** Attaches this scroll strategy to an overlay. */\r\n  attach(overlayRef: OverlayReference) {\r\n    if (this._overlayRef) {\r\n      throw getMatScrollStrategyAlreadyAttachedError();\r\n    }\r\n\r\n    this._overlayRef = overlayRef;\r\n  }\r\n\r\n  /** Enables repositioning of the attached overlay on scroll. */\r\n  enable() {\r\n    if (!this._scrollSubscription) {\r\n      const throttle = this._config ? this._config.scrollThrottle : 0;\r\n\r\n      this._scrollSubscription = this._scrollDispatcher.scrolled(throttle).subscribe(() => {\r\n        this._overlayRef.updatePosition();\r\n\r\n        // TODO(crisbeto): make `close` on by default once all components can handle it.\r\n        if (this._config && this._config.autoClose) {\r\n          const overlayRect = this._overlayRef.overlayElement.getBoundingClientRect();\r\n          const {width, height} = this._viewportRuler.getViewportSize();\r\n\r\n          // TODO(crisbeto): include all ancestor scroll containers here once\r\n          // we have a way of exposing the trigger element to the scroll strategy.\r\n          const parentRects = [{width, height, bottom: height, right: width, top: 0, left: 0}];\r\n\r\n          if (isElementScrolledOutsideView(overlayRect, parentRects)) {\r\n            this.disable();\r\n            this._ngZone.run(() => this._overlayRef.detach());\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /** Disables repositioning of the attached overlay on scroll. */\r\n  disable() {\r\n    if (this._scrollSubscription) {\r\n      this._scrollSubscription.unsubscribe();\r\n      this._scrollSubscription = null;\r\n    }\r\n  }\r\n}\r\n"]}